<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Finance App - Stephen Wilkinson's Portfolio</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&display=swap' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .market-panel {
            background-color: #2B2C2F;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        body.light-mode .market-panel {
            background-color: #ffffff;
        }
        .heatmap {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 5px;
        }
        .heatmap div {
            padding: 20px;
            text-align: center;
            color: #fff;
            cursor: pointer;
        }
        .news-ticker {
            background-color: #232526;
            padding: 10px;
            color: #F4F4F9;
            overflow: hidden;
            white-space: nowrap;
        }
        .news-item {
            display: inline-block;
            padding-right: 50px;
            animation: ticker 20s linear infinite;
        }
        @keyframes ticker {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }
        .suggestions {
            position: absolute;
            background: #2B2C2F;
            width: 100%;
            z-index: 1050;
        }
        .suggestions div {
            padding: 5px 10px;
            cursor: pointer;
        }
        .suggestions div:hover {
            background: #5D737E;
        }
        body.light-mode .suggestions {
            background: #ffffff;
        }
    </style>
</head>
<body>
<a id="top"></a>
<div id="headerInclude"></div>
<main class="container mt-4">
    <div class="position-relative mb-3">
        <input id="searchInput" type="text" class="form-control" placeholder="Search stocks">
        <div id="suggestions" class="suggestions d-none"></div>
    </div>
    <div id="marketOverview" class="row"></div>
    <div class="row">
        <div class="col-md-6">
            <h4>Top Gainers</h4>
            <ul id="gainers" class="list-unstyled"></ul>
        </div>
        <div class="col-md-6">
            <h4>Top Losers</h4>
            <ul id="losers" class="list-unstyled"></ul>
        </div>
    </div>
    <h4 class="mt-4">Market Heat Map</h4>
    <div id="heatMap" class="heatmap mb-4"></div>
    <h4>Major News</h4>
    <div id="newsTicker" class="news-ticker mb-4"></div>
    <h4>Signal Alerts</h4>
    <ul id="signals" class="list-unstyled"></ul>
    <h4 class="mt-4">Economic Calendar</h4>
    <table id="econCalendar" class="table table-sm table-striped"></table>
    <h4 class="mt-4">Earnings Calendar</h4>
    <table id="earningsCalendar" class="table table-sm table-striped"></table>
</main>
<div id="footerInclude"></div>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
<script>
$(document).ready(function(){
    $("#headerInclude").load("header.html", function() {
        const toggle = $("#darkModeToggle");
        function updateToggleText() {
            toggle.text($("body").hasClass("light-mode") ? "Dark Mode" : "Light Mode");
        }
        toggle.on("click", function() {
            $("body").toggleClass("light-mode");
            localStorage.setItem("theme", $("body").hasClass("light-mode") ? "light" : "dark");
            updateToggleText();
        });
        updateToggleText();
    });
    $("#footerInclude").load("footer.html");
    if (localStorage.getItem("theme") === "light") { $("body").addClass("light-mode"); }

    const indices = [
        { name: 'DOW', symbol: 'DJI' },
        { name: 'NASDAQ', symbol: 'IXIC' },
        { name: 'S&P 500', symbol: 'GSPC' },
        { name: 'RUSSELL 2000', symbol: 'RUT' }
    ];

    const samplePrice = () => 30000 + Math.random() * 1000;
    const sampleChange = () => (Math.random() - 0.5) * 2;
    const generateSeries = () => {
        const data = [];
        for(let i=0;i<30;i++) data.push(samplePrice() + sampleChange()*50);
        return data;
    };

    const renderMarket = () => {
        $('#marketOverview').empty();
        indices.forEach(idx => {
            const price = samplePrice();
            const change = sampleChange();
            const color = change >=0 ? 'text-success' : 'text-danger';
            const card = $(
                `<div class='col-md-6 col-lg-3'><div class='market-panel'>
                    <h5>${idx.name}</h5>
                    <p>$${price.toFixed(2)} <span class='${color}'>(${change.toFixed(2)}%)</span></p>
                    <canvas id='chart-${idx.symbol}' height='80'></canvas>
                </div></div>`);
            $('#marketOverview').append(card);
            new Chart(card.find('canvas'), {
                type: 'line',
                data: { labels: Array.from({length:30},(_,i)=>i+1), datasets:[{ data: generateSeries(), borderColor: '#5D737E', fill:false, tension:0.3 }] },
                options: {responsive:true, plugins:{legend:{display:false}}, scales:{x:{display:false},y:{display:false}}}
            });
        });
    };

    const stocksData = [
        { ticker:'AAPL', name:'Apple Inc.', sector:'Technology', pe:29, rsi:60 },
        { ticker:'MSFT', name:'Microsoft Corp.', sector:'Technology', pe:35, rsi:55 },
        { ticker:'GOOGL', name:'Alphabet Inc.', sector:'Communication Services', pe:25, rsi:50 },
        { ticker:'AMZN', name:'Amazon.com Inc.', sector:'Consumer Cyclical', pe:70, rsi:65 },
        { ticker:'TSLA', name:'Tesla Inc.', sector:'Consumer Cyclical', pe:80, rsi:72 },
        { ticker:'JPM', name:'JPMorgan Chase & Co.', sector:'Financial', pe:10, rsi:40 },
        { ticker:'XOM', name:'Exxon Mobil Corp.', sector:'Energy', pe:15, rsi:45 },
        { ticker:'UNH', name:'UnitedHealth Group Inc.', sector:'Healthcare', pe:22, rsi:58 }
    ];
    const stockTickers = stocksData.map(s=>s.ticker);
    const getRandomStocks = () => stockTickers.sort(()=>0.5-Math.random()).slice(0,3).map(s=>`${s} ${(Math.random()*10).toFixed(2)}%`);

    const renderLists = () => {
        const gainers = getRandomStocks();
        const losers = getRandomStocks();
        $('#gainers').html(gainers.map(g=>`<li class='text-success'>${g}</li>`));
        $('#losers').html(losers.map(l=>`<li class='text-danger'>${l}</li>`));
    };

    const heatSectors = ['Technology','Financial','Healthcare','Consumer Cyclical','Energy','Utilities'];
    const renderHeatmap = () => {
        $('#heatMap').empty();
        heatSectors.forEach(sec => {
            const perf = (Math.random()-0.5)*4;
            const color = perf>0 ? `rgba(40,167,69,${Math.min(1,perf/4+0.3)})` : `rgba(220,53,69,${Math.min(1,-perf/4+0.3)})`;
            const div = $(`<div style='background:${color}' title='${sec}: ${perf.toFixed(2)}%'>${sec}</div>`);
            $('#heatMap').append(div);
        });
    };

    const headlines = [
        'Stocks edge higher amid earnings reports',
        'Federal Reserve signals rate pause',
        'Oil prices fall on demand concerns',
        'Tech sector leads market gains'
    ];
    const renderNews = () => {
        const html = headlines.map(h=>`<span class='news-item'>${new Date().toLocaleTimeString()} - ${h}</span>`).join('');
        $('#newsTicker').html(html);
    };

    const signals = [ 'AAPL breaks resistance', 'TSLA forms double top', 'AMZN hits new high', 'MSFT approaching support' ];
    $('#signals').html(signals.map(s=>`<li>${s}</li>`));

    const econ = [
        { date:'2024-06-01', event:'Nonfarm Payrolls', impact:'High', actual:'250K', expected:'200K', previous:'220K' },
        { date:'2024-06-03', event:'ISM Manufacturing', impact:'Medium', actual:'52', expected:'51', previous:'50' }
    ];
    const renderTable = (tbl, data) => {
        const header = Object.keys(data[0]);
        const th = '<tr>' + header.map(h=>`<th>${h}</th>`).join('') + '</tr>';
        const rows = data.map(d=> '<tr>'+ header.map(h=>`<td>${d[h]}</td>`).join('') + '</tr>').join('');
        tbl.html(th+rows);
    };
    renderTable($('#econCalendar'), econ);

    const earnings = [
        { date:'2024-06-02', ticker:'AAPL', est:'$1.20', importance:'High' },
        { date:'2024-06-04', ticker:'MSFT', est:'$2.30', importance:'Medium' }
    ];
    renderTable($('#earningsCalendar'), earnings);

    const advancedSearch = query => {
        const q = query.trim().toUpperCase();
        if(!q) return [];
        const ind = q.match(/(PE|RSI)\s*(>=|<=|>|<)\s*(\d+(\.\d+)?)/);
        return stocksData.filter(s => {
            if(ind){
                const val = parseFloat(ind[3]);
                const num = s[ind[1].toLowerCase()];
                switch(ind[2]){
                    case '>': return num > val;
                    case '<': return num < val;
                    case '>=': return num >= val;
                    case '<=': return num <= val;
                }
                return false;
            }
            return s.ticker.includes(q) || s.name.toUpperCase().includes(q) || s.sector.toUpperCase().includes(q);
        });
    };
    $('#searchInput').on('input', function(){
        const results = advancedSearch(this.value);
        if(results.length){
            const html = results.slice(0,5).map(s=>`<div>${s.ticker} - ${s.name}</div>`).join('');
            $('#suggestions').html(html).removeClass('d-none');
        } else {
            $('#suggestions').addClass('d-none');
        }
    });
    $('#suggestions').on('click','div',function(){
        $('#searchInput').val($(this).text());
        $('#suggestions').addClass('d-none');
    });

    renderMarket();
    renderLists();
    renderHeatmap();
    renderNews();
    setInterval(()=>{ renderMarket(); renderLists(); renderHeatmap(); }, 60000);
});
</script>
</body>
</html>
